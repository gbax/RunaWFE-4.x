<?xml version="1.0" encoding="UTF-8"?>
<process-definition name="MultiInstanceProcess" xmlns="urn:jbpm.org:jpdl-3.2">
  <description><![CDATA[A demo process with Multi instance node]]></description>
  <swimlane name="operator">
    <assignment
      class="ru.runa.wf.jbpm.delegation.assignment.AssignmentHandler" config-type="configuration-property"><![CDATA[]]></assignment>
  </swimlane>
  <start-state name="Start">
    <task name="Start" swimlane="operator"/>
    <transition name="tr1" to="confirm order"/>
  </start-state>
  <task-node name="confirm order">
    <description><![CDATA[confirm order]]></description>
    <task name="confirm order" swimlane="operator">
      <event type="task-create">
        <action
          class="ru.runa.wfe.bp.commons.ExecuteFormulaActionHandler" config-type="configuration-property"><![CDATA[addressArray = ""

]]></action>
      </event>
      <event type="task-create">
        <action class="ru.runa.wf.BSHActionHandler" config-type="configuration-property"><![CDATA[int n = Integer.parseInt(multNumber);
String[] array = new String[n];
for (int i=0; i < n; i++){
     array[i] = "address  "+(i+1);
};
addressArray = array;

]]></action>
      </event>
    </task>
    <transition name="tr1" to="start suborders routine "/>
  </task-node>
  <multiinstance-state name="start suborders routine ">
    <transition name="tr1" to="End"/>
    <sub-process binding="late" name="MultiInstanceSubProcess"/>
    <variable access="read" mapped-name="operator" name="operator"/>
    <variable access="read,multiinstancelink" mapped-name="address" name="addressArray"/>
  </multiinstance-state>
  <event type="subprocess-created">
    <action
      class="ru.runa.wf.jbpm.delegation.action.SetSubProcessPermissionsActionHandler" config-type="configuration-property"><![CDATA[]]></action>
  </event>
  <end-state name="End"/>
</process-definition>
