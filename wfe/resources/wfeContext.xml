<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jee="http://www.springframework.org/schema/jee"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
       http://www.springframework.org/schema/aop 
       http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
       http://www.springframework.org/schema/jee 
       http://www.springframework.org/schema/jee/spring-jee-2.5.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context-2.5.xsd
       http://www.springframework.org/schema/task 
       http://www.springframework.org/schema/task/spring-task-3.0.xsd">

  <bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
    <property name="location">
      <value>classpath:wfe.properties</value>
    </property>
  </bean>

	<bean class="ru.runa.af.dao.impl.ExecutorDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.SecuredObjectDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.PermissionDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.RelationDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.SubstitutionDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.ProfileDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.BotsDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.InitializerDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.af.dao.impl.SystemLogDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.wf.dao.impl.ArchiveDAOHibernateImpl">
    <property name="sessionFactory" ref="sessionFactory" />
	</bean>
	<bean class="ru.runa.wf.dao.impl.TmpDAOImpl">
    <property name="sessionFactory" ref="sessionFactory" />
		<property name="bpInstanceSaveOperations">
			<list>
				<bean class="ru.runa.bpm.svc.save.HibernateSaveOperation" />
				<bean class="ru.runa.bpm.svc.save.SaveLogsOperation" />
				<bean class="ru.runa.bpm.svc.save.CascadeSaveOperation" />
			</list>
		</property>
	</bean>
	
	<bean class="ru.runa.wf.caches.ProcessDefCacheCtrl" />
	
	
	<bean class="ru.runa.af.logic.CommonLogic" />
	<bean class="ru.runa.af.logic.AuthenticationLogic" />
	<bean class="ru.runa.af.logic.AuthorizationLogic" />
	<bean class="ru.runa.af.logic.BotsLogic" />
	<bean class="ru.runa.af.logic.ExecutorLogic">
    	<property name="passwordCheckPattern" value="${strong.passwords.regexp}" />
	</bean>
	<bean class="ru.runa.af.logic.ProfileLogic" />
	<bean class="ru.runa.af.logic.RelationLogic" />
	<bean class="ru.runa.af.logic.SubstitutionLogic" />
	<bean class="ru.runa.af.logic.SystemLogic" />
	<bean class="ru.runa.af.logic.LDAPImporter" />
	<bean class="ru.runa.wf.logic.ArchivingLogic" />
	<bean class="ru.runa.wf.logic.JbpmDefinitionLogic" />
	<bean class="ru.runa.wf.logic.JbpmExecutionLogic" />
	<bean class="ru.runa.wf.logic.WfeScriptRunner" />
	
	<bean class="ru.runa.wf.logic.WFInitializerLogic">
		<property name="administratorName" value="${default.administrator.name}" />
		<property name="administratorDescription" value="${default.administrator.description}" />
		<property name="administratorPassword" value="${default.administrator.password}" />
		<property name="administratorGroupName" value="${default.administrators.group.name}" />
		<property name="administratorGroupDescription" value="${default.administrators.group.description}" />
	</bean>

	<bean class="ru.runa.wf.TaskStubFactory" />
	
	
	<bean id="cacheUsageStatisticTask" class="org.springframework.scheduling.timer.ScheduledTimerTask">
	  <property name="delay" value="60000"/>
	  <property name="period" value="60000"/>
	  <property name="timerTask">
      <bean class="ru.runa.wf.periodic.CacheUsageStatisticLogger">
      </bean>
	  </property>
	</bean>
	<bean id="timersRemoverTask" class="org.springframework.scheduling.timer.ScheduledTimerTask">
	  <property name="delay" value="10000"/>
	  <property name="period" value="600000"/>
	  <property name="timerTask">
      <bean class="ru.runa.wf.periodic.TimersRemover">
      </bean>
	  </property>
	</bean>
	<bean id="tasksAssignTask" class="org.springframework.scheduling.timer.ScheduledTimerTask">
	  <property name="delay" value="5000"/>
	  <property name="period" value="600000"/>
	  <property name="timerTask">
      <bean class="ru.runa.wf.periodic.TaskAssigner">
      </bean>
	  </property>
	</bean>
	
	<bean id="timerFactory" class="org.springframework.scheduling.timer.TimerFactoryBean">
    <property name="scheduledTimerTasks">
      <list>
        <ref bean="jobExecutorTask"/>
        <ref bean="cacheUsageStatisticTask"/>
        <ref bean="timersRemoverTask"/>
        <ref bean="tasksAssignTask"/>
      </list>
    </property>
  </bean>

</beans>
