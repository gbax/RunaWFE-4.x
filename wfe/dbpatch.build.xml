<?xml version="1.0" encoding="UTF-8" ?>

<project name="WFE.Database Patches" default="dist.app" basedir=".">
	<!-- set global properties for this build -->
	<dirname property="WFE.Database Patches.basedir" file="${ant.file.WFE.Database Patches}"/>
	<import file="${WFE.Database Patches.basedir}/wfe.common.xml"/>

	<property name="src.dir" location="src/dbpatch" />

	<property name="build.app.classes.dir" location="${build.dir}/app/dbpatch/classes" />

	<property name="dbpatch.dist.dir" location="${dist.dir}/dbpatch" />

	<property name="dbpatch.jar.file" location="${dbpatch.dist.dir}/runawfe-dbpatch.jar" />

	<target name="clean" description="clean up">
		<delete dir="${build.app.classes.dir}" />
		<delete dir="${dbpatch.dist.dir}" />
		<delete file="${dbpatch.jar.file}" failonerror="false" />
	</target>

	<target name="init">
		<tstamp />
		<mkdir dir="${build.app.classes.dir}" />
		<mkdir dir="${dbpatch.dist.dir}" />
	</target>


	<target name="compile.app" depends="init" description="compile the source of application">

		<javac destdir="${build.app.classes.dir}" debug="${javac.debug}"  encoding="UTF-8" target="${javac.target}" source="${javac.source}">
			<src path="${src.dir}" />
			<classpath refid="lib.classpath" />
			<classpath refid="app.class.path" />
		</javac>
	</target>

	<target name="dist.app" depends="compile.app">
		<jar destfile="${dbpatch.jar.file}">
			<manifest>
				<attribute name="Main-Class" value="ru.runa.dbpatch.DBPatchRunner" />
			</manifest>
			<zipfileset dir="${build.app.classes.dir}" />
		</jar>
		<copy file="tools/dbpatch.bat" todir="${dbpatch.dist.dir}" />
		<copy file="lib/jtds/jtds-1.2.jar" todir="${dbpatch.dist.dir}" />
		<copy file="lib/commons/commons-logging.jar" todir="${dbpatch.dist.dir}" />
		<copy file="${dist.deploy.dir}/runa-common.jar" todir="${dbpatch.dist.dir}" />
		<copy file="${dist.deploy.dir}/af.core.jar" todir="${dbpatch.dist.dir}" />

	</target>

</project>
