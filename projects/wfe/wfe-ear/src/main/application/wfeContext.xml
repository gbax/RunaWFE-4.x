<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:jee="http://www.springframework.org/schema/jee"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:task="http://www.springframework.org/schema/task"
	xsi:schemaLocation="
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/tx 
       http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
       http://www.springframework.org/schema/aop 
       http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
       http://www.springframework.org/schema/jee 
       http://www.springframework.org/schema/jee/spring-jee-2.5.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context-2.5.xsd
       http://www.springframework.org/schema/task 
       http://www.springframework.org/schema/task/spring-task-3.0.xsd">

	<bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location">
			<value>classpath:wfe.properties</value>
		</property>
	</bean>

	<tx:jta-transaction-manager />
	<tx:annotation-driven proxy-target-class="true" />
	<context:annotation-config />

	<bean id="sessionFactory"
		class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
		<property name="configLocation" value="classpath:hibernate.cfg.xml" />
		<property name="entityInterceptor">
			<bean class="ru.runa.wfe.commons.hibernate.WFRunaHibernateInterceptor" />
		</property>
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.transaction.manager_lookup_class">org.hibernate.transaction.JBossTransactionManagerLookup</prop>
				<prop key="hibernate.connection.autocommit">false</prop>
			</props>
		</property>
	</bean>

	<bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
		<property name="sessionFactory" ref="sessionFactory" />
	</bean>


	<!-- converters -->
	<bean id="stringToByteArrayConverter" class="ru.runa.wfe.var.converter.StringToByteArrayConverter" />
	<bean id="booleanToStringConverter" class="ru.runa.wfe.var.converter.BooleanToStringConverter" />
	<bean id="intToLongConverter" class="ru.runa.wfe.var.converter.IntegerToLongConverter" />
	<bean id="serializableToByteArrayConverter"
		class="ru.runa.wfe.var.converter.SerializableToByteArrayConverter" />
	<bean id="executorToLongConverter" class="ru.runa.wfe.var.converter.ExecutorToLongConverter" />

	<bean id="converters" class="ru.runa.wfe.commons.hibernate.Converters">
		<property name="mappings">
			<map>
				<entry key="B" value-ref="booleanToStringConverter" />
				<entry key="I" value-ref="intToLongConverter" />
				<entry key="R" value-ref="serializableToByteArrayConverter" />
				<entry key="S" value-ref="stringToByteArrayConverter" />
				<entry key="E" value-ref="executorToLongConverter" />
			</map>
		</property>
	</bean>

	<bean id="variableCreator" class="ru.runa.wfe.var.VariableCreator">
		<property name="types">
			<list>
				<!-- java.lang.String (<= 1024 symbols) -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.StringMatcher">
							<property name="large" value="false" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.StringVariable" />
				</bean>
				<!-- java.lang.String (> 1024 symbols) -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.StringMatcher">
							<property name="large" value="true" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.ByteArrayVariable" />
					<property name="converter" ref="stringToByteArrayConverter" />
				</bean>
				<!-- java.lang.Boolean -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.ClassNameMatcher">
							<property name="className" value="java.lang.Boolean" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.StringVariable" />
					<property name="converter" ref="booleanToStringConverter" />
				</bean>
				<!-- java.lang.Long -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.ClassNameMatcher">
							<property name="className" value="java.lang.Long" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.LongVariable" />
				</bean>
				<!-- java.lang.Integer -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.ClassNameMatcher">
							<property name="className" value="java.lang.Integer" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.LongVariable" />
					<property name="converter" ref="intToLongConverter" />
				</bean>
				<!-- java.lang.Double -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.ClassNameMatcher">
							<property name="className" value="java.lang.Double" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.DoubleVariable" />
				</bean>
				<!-- java.util.Date -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.ClassNameMatcher">
							<property name="className" value="java.util.Date" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.DateVariable" />
				</bean>
				<!-- byte[] -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.ClassNameMatcher">
							<property name="className" value="[B" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.ByteArrayVariable" />
				</bean>
				<!-- ru.runa.wfe.user.Executor -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.ClassNameMatcher">
							<property name="className" value="ru.runa.wfe.user.Executor" />
						</bean>
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.LongVariable" />
					<property name="converter" ref="executorToLongConverter" />
				</bean>
				<!-- java.io.Serializable -->
				<bean class="ru.runa.wfe.var.VariableType">
					<property name="matcher">
						<bean class="ru.runa.wfe.var.matcher.SerializableMatcher" />
					</property>
					<property name="variableClass" value="ru.runa.wfe.var.impl.ByteArrayVariable" />
					<property name="converter" ref="serializableToByteArrayConverter" />
				</bean>
			</list>
		</property>
	</bean>



	<bean class="ru.runa.wfe.bot.dao.BotStationDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.bot.dao.BotDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.bot.dao.BotTaskDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.commons.dao.ConstantDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.definition.dao.DeploymentDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.user.dao.ExecutorDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.job.dao.JobDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.commons.dao.LocalizationDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.execution.dao.NodeProcessDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.security.dao.PermissionDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.execution.dao.ProcessDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.audit.dao.ProcessLogDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.user.dao.ProfileDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.relation.dao.RelationDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.ss.dao.SubstitutionDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.ss.dao.SubstitutionCriteriaDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.audit.dao.SystemLogDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.task.dao.TaskDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.execution.dao.TokenDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>
	<bean class="ru.runa.wfe.var.dao.VariableDAO">
		<property name="hibernateTemplate" ref="hibernateTemplate" />
	</bean>

	<bean class="ru.runa.wfe.definition.cache.ProcessDefCacheCtrl" />

	<bean class="ru.runa.wfe.definition.dao.ProcessDefinitionLoader">
	</bean>

	<bean class="ru.runa.wfe.task.TaskFactory">
		<property name="defaultTaskDeadline" value="${task.default.deadline}" />
		<!-- property name="taskNotifier"> <bean class="ru.runa.wfe.task.EmailTaskNotifier"> 
			</bean> </property -->
	</bean>

	<bean class="ru.runa.wfe.task.dto.WfTaskFactory">
		<property name="taskAlmostDeadline" value="${task.almostDeadline}" />
	</bean>

	<bean class="ru.runa.wfe.execution.ProcessFactory">
	</bean>
	
	<bean class="ru.runa.wfe.task.TasklistBuilder">
	</bean>


	<bean class="ru.runa.wfe.commons.logic.CommonLogic" />
	<bean class="ru.runa.wfe.security.logic.AuthenticationLogic">
		<property name="loginHandlers">
			<list>
				<!-- bean class="ru.runa.wfe.security.logic.LDAPImporter" / -->
			</list>
		</property>
		<property name="loginModuleConfiguration">
			<bean class="ru.runa.wfe.security.auth.LoginModuleConfiguration">
				<property name="loginModuleClassNames">
					<list>
						<value>ru.runa.wfe.security.auth.InternalDBPasswordLoginModule</value>
						<!-- value>ru.runa.wfe.security.auth.ADPasswordLoginModule</value -->
						<!-- value>ru.runa.wfe.security.auth.KerberosLoginModule</value -->
						<value>ru.runa.wfe.security.auth.PrincipalLoginModule</value>
					</list>
				</property>
			</bean>
		</property>
	</bean>
	<bean class="ru.runa.wfe.security.logic.AuthorizationLogic" />
	<bean class="ru.runa.wfe.bot.logic.BotLogic" />
	<bean class="ru.runa.wfe.user.logic.ExecutorLogic">
		<property name="passwordCheckPattern" value="${strong.passwords.regexp}" />
		<property name="setStatusHandlers">
			<list>
				<!-- bean class="ru.runa.wfe.synchronizer.online.ActorStatusSynchronizer" 
					/ -->
			</list>
		</property>
	</bean>
	<bean class="ru.runa.wfe.user.logic.ProfileLogic" />
	<bean class="ru.runa.wfe.relation.logic.RelationLogic" />
	<bean class="ru.runa.wfe.ss.logic.SubstitutionLogic" />
	<bean class="ru.runa.wfe.audit.logic.AuditLogic" />
	<bean class="ru.runa.wfe.security.logic.LDAPImporter" />
	<bean class="ru.runa.wfe.definition.logic.DefinitionLogic" />
	<bean class="ru.runa.wfe.execution.logic.ExecutionLogic" />
	<bean class="ru.runa.wfe.task.logic.TaskLogic" />
	<bean class="ru.runa.wfe.var.logic.VariableLogic" />
	<bean class="ru.runa.wfe.handler.assign.AssignmentHelper" />
	<bean class="ru.runa.wfe.script.AdminScriptRunner" />

	<bean class="ru.runa.wfe.commons.logic.InitializerLogic">
		<property name="administratorName" value="${default.administrator.name}" />
		<property name="administratorDescription" value="${default.administrator.description}" />
		<property name="administratorPassword" value="${default.administrator.password}" />
		<property name="administratorGroupName" value="${default.administrators.group.name}" />
		<property name="administratorGroupDescription" value="${default.administrators.group.description}" />
	</bean>



	<bean id="jobExecutorTask" class="org.springframework.scheduling.timer.ScheduledTimerTask">
		<property name="delay" value="60000" />
		<property name="period" value="60000" />
		<property name="timerTask">
			<bean class="ru.runa.wfe.job.impl.ExpiredJobCheckerTask">
				<property name="executor">
					<bean class="ru.runa.wfe.job.impl.JobExecutor">
					</bean>
				</property>
			</bean>
		</property>
	</bean>
	<bean id="cacheUsageStatisticTask" class="org.springframework.scheduling.timer.ScheduledTimerTask">
		<property name="delay" value="60000" />
		<property name="period" value="60000" />
		<property name="timerTask">
			<bean class="ru.runa.wfe.job.impl.CacheUsageStatisticLogger">
			</bean>
		</property>
	</bean>
	<bean id="tasksAssignTask" class="org.springframework.scheduling.timer.ScheduledTimerTask">
		<property name="delay" value="5000" />
		<property name="period" value="600000" />
		<property name="timerTask">
			<bean class="ru.runa.wfe.job.impl.AssignStalledTasks">
				<property name="executor">
					<bean class="ru.runa.wfe.job.impl.TaskAssigner">
					</bean>
				</property>
			</bean>
		</property>
	</bean>
	<bean id="timerFactory" class="org.springframework.scheduling.timer.TimerFactoryBean">
		<property name="scheduledTimerTasks">
			<list>
				<ref bean="jobExecutorTask" />
				<ref bean="cacheUsageStatisticTask" />
				<ref bean="tasksAssignTask" />
			</list>
		</property>
	</bean>


	<bean id="businessCalendar" class="ru.runa.wfe.commons.calendar.impl.BusinessCalendarImpl">
		<!-- property name="" value="" / -->
	</bean>

</beans>
